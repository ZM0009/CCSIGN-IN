<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Class Clowns Sports Day – Audience Sign In</title>
<link href="https://fonts.googleapis.com/css2?family=Graduate&family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --blue:#0a3d91;
  --blue-mid:#1e5fd8;
  --blue-light:#e6f0ff;
  --white:#ffffff;
  --ink:#0b1b33;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,sans-serif;background:linear-gradient(180deg,var(--blue-light),#ffffff);color:var(--ink);}
header{background:linear-gradient(90deg,var(--blue),var(--blue-mid));color:#fff;padding:18px;display:flex;justify-content:space-between;align-items:center;gap:12px;position:sticky;top:0;}
header h1{font-family:Graduate,serif;font-size:22px;letter-spacing:1px;margin:0;text-transform:uppercase;}
header .tabs{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;}
header button{padding:10px 14px;border-radius:999px;border:2px solid #fff;background:transparent;color:#fff;font-weight:800;cursor:pointer;}
header button:hover{background:#fff;color:var(--blue);}
main{max-width:1200px;margin:auto;padding:20px;}
.hidden{display:none}
#search{width:100%;padding:14px;border-radius:14px;border:2px solid var(--blue);font-size:16px;}
.lists{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:18px;}
.panel{background:#fff;border-radius:18px;padding:14px;box-shadow:0 10px 24px rgba(10,61,145,.15);}
.panel h3{margin:0 0 10px;color:var(--blue);font-weight:900;letter-spacing:.4px;text-transform:uppercase;font-size:14px;}
.list{max-height:65vh;overflow:auto;padding:6px;border-radius:14px;border:1px solid rgba(10,61,145,.12);}
.item{padding:12px;border-radius:12px;background:var(--blue-light);margin-bottom:6px;cursor:pointer;font-weight:700;}
.item:hover{background:var(--blue-mid);color:#fff;}
.actions{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0;}
.actions button{border:2px solid var(--blue);background:#fff;color:var(--blue);font-weight:900;border-radius:14px;padding:10px 14px;cursor:pointer;}
.actions button:hover{background:var(--blue);color:#fff;}
.actions .danger{border-color:#c51f3a;color:#c51f3a;}
.actions .danger:hover{background:#c51f3a;color:#fff;}
textarea{width:100%;height:240px;padding:14px;border-radius:16px;border:2px solid var(--blue);font-family:Inter,system-ui,sans-serif;}
.small{color:rgba(11,27,51,.7);font-weight:600;margin:0 0 10px;}
@media(max-width:800px){.lists{grid-template-columns:1fr}.list{max-height:50vh}}
</style>
</head>
<body>
<header>
  <h1>Class Clowns Sports Day – Audience Sign In</h1>
  <div class="tabs">
    <button type="button" onclick="showTab('board')">Board</button>
    <button type="button" onclick="showTab('finish')">Finish</button>
    <button type="button" onclick="showTab('add')">Add Names</button>
  </div>
</header>

<main>
  <section id="board">
    <input id="search" placeholder="Search name…">
    <div class="lists">
      <div class="panel">
        <h3>Not Signed In <span id="unsignedCount"></span></h3>
        <div class="list" id="unsigned"></div>
      </div>
      <div class="panel">
        <h3>Signed In <span id="signedCount"></span></h3>
        <div class="list" id="signed"></div>
      </div>
    </div>
  </section>

  <section id="finish" class="hidden">
    <div class="panel">
      <h3>Signed-In List <span id="exportCount"></span></h3>
      <div class="actions">
        <button type="button" onclick="copyList()">Copy</button>
        <button type="button" onclick="downloadCSV()">Download CSV</button>
        <button type="button" class="danger" onclick="resetAll()">Reset</button>
      </div>
      <textarea id="exportEl" readonly></textarea>
    </div>
  </section>

  <section id="add" class="hidden">
    <div class="panel">
      <h3>Add Walk-Ups</h3>
      <p class="small">Enter one name per line. Added names are saved permanently on this device.</p>
      <textarea id="newNames" placeholder="One name per line"></textarea>
      <div class="actions">
        <button type="button" onclick="addNames()">Add to roster</button>
        <button type="button" onclick="showTab('board')">Back to board</button>
      </div>
    </div>
  </section>
</main>

<script>
const STORAGE_ROSTER = "roster_v2";
const STORAGE_SIGNED = "signed_v2";

const DEFAULT_ROSTER = ["Abbi Andrews", "Adrian Tasselli", "Aleigha Lamb", "Alessandra Lasas Prado", "Alex Delis", "Alex Li", "Alex V", "Ali Bagheban", "Alinta-Jade Quayle", "Andrew Hall", "April Laird", "Belinda Andrade", "Bhoomi Miswin", "Bingyan Xu", "Cade Buchanan", "Carmela Karipis", "Caroline Leon", "Chae Ruffo", "Charlotte Rosenwould", "Chloe Lambert", "Chloe Quayle-Williams", "Christina Wei", "Claire Coope", "Dara Kaldor", "Darren Hopwood", "Demetra Proestos", "Elizabeth Dormido", "Elizabeth Langley", "Emily Weskin", "Emily Zhang", "Erandi Kuruppuarachchi", "Fatih Sonmez", "Fiona Doig", "Florian Cerveaux", "Georgia Middleton", "Gillian Sheargold", "Glenn Paul", "Gokcem Sonmez", "Gul Shanobar Shaik", "Guy Kellaway", "Hannah White", "Hassan Marasigan", "Hayley Arroyo", "Holly Price", "Hudson Donoghue", "Jack Rowland", "Jackie Nevill", "Jade Davis", "Jake Saad", "James Louvris", "Jamie Wales", "Jamil Bayeh", "Jane Aellig", "Jason Tleige", "Jayanti Mandasari", "Jayden Thomas", "Jean Mathew", "Jesse Donoghue", "Jessica Strobach", "Jessica Taylor", "JG Constantine", "Jodee Knowles", "Jodie Chapman", "Joel Bell", "Jon LS", "Josephine Karipis", "Joshua Catania", "Justin Lopes", "Kane Barker", "Kee Forster", "Keith Hampton", "Kimberly Burns", "Klara Aellig", "Lara Weskin", "Laura Chapman", "Leanne Thomas", "Leo Lavecky", "Lilly Bayeh", "Lucia Andrade", "Lyn Lace", "Lynette Cole", "Magalie Rouillard-Bazinet", "Mani Grover", "Maria Tavares", "Mariana Pineda Ladino", "Marilyn Mariakis", "Matthew Pails", "Medina Sonmez", "Melissa Davidson", "Michael Komolafe", "Michelle Morris", "Miswin Mahesh", "Mohammed JaliliBaleh", "Molly Smith", "Morgan Sheargold", "Mustaf Ali", "Naithan Sheridan", "Nathan Flint", "Neil Single", "Niamh Bray", "Nikitha E", "Nina Blair", "Olivia Vaughan", "Opus Cranney", "Pablo Andrade", "Paula Martin", "Poppy Millanta", "Rami Tamer", "Rebecca Hegarty", "Reena Mahesh", "Robert Tannous", "Sarika Vashisth", "Sema Sert", "Shnaya Vashisth", "Sophia Le", "Stan Cebokli", "Sue OReilly", "Thira Miswin", "Tina Tasselli", "Trav Hopwood", "Trish Saad", "Velutha Parambath Mahesan", "Violet Arroyo", "Willa Zheng", "William Rosenwould", "Zaian Arpa"];

function loadArray(key, fallback){
  try {
    const raw = localStorage.getItem(key);
    if(!raw) return fallback;
    const parsed = JSON.parse(raw);
    return Array.isArray(parsed) ? parsed : fallback;
  } catch {
    return fallback;
  }
}

let roster = loadArray(STORAGE_ROSTER, DEFAULT_ROSTER.slice());
let signed = loadArray(STORAGE_SIGNED, []);

const el = (id) => document.getElementById(id);

function saveRoster(){ localStorage.setItem(STORAGE_ROSTER, JSON.stringify(roster)); }
function saveSigned(){ localStorage.setItem(STORAGE_SIGNED, JSON.stringify(signed)); }

function showTab(id){
  ["board","finish","add"].forEach(t => el(t).classList.add("hidden"));
  el(id).classList.remove("hidden");
  render();
}

function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
function escapeAttr(str){
  return String(str).replaceAll('"',"&quot;");
}

function render(){
  const q = (el("search").value || "").toLowerCase();
  const unsigned = roster.filter(n => !signed.includes(n) && n.toLowerCase().includes(q));

  el("unsigned").innerHTML = unsigned.map(n => `<div class="item" data-name="${escapeAttr(n)}">${escapeHtml(n)}</div>`).join("");
  el("signed").innerHTML = signed.map(n => `<div class="item" data-name="${escapeAttr(n)}">${escapeHtml(n)}</div>`).join("");

  el("unsignedCount").textContent = `(${unsigned.length})`;
  el("signedCount").textContent = `(${signed.length})`;
  el("exportCount").textContent = `(${signed.length})`;
  el("exportEl").value = signed.join("\n");
}

// Click handling (no inline onclick, so names can never break JS)
el("unsigned").addEventListener("click", (e) => {
  const item = e.target.closest(".item");
  if(!item) return;
  const name = item.textContent;
  if(!signed.includes(name)){
    signed.push(name);
    saveSigned();
    render();
  }
});

el("signed").addEventListener("click", (e) => {
  const item = e.target.closest(".item");
  if(!item) return;
  const name = item.textContent;
  signed = signed.filter(n => n !== name);
  saveSigned();
  render();
});

el("search").addEventListener("input", render);

function addNames(){
  const lines = (el("newNames").value || "").split(/\r?\n/).map(s => s.trim()).filter(Boolean);
  let changed = false;

  for(const n of lines){
    if(!roster.includes(n)){
      roster.push(n);
      changed = true;
    }
  }

  if(changed){
    roster.sort((a,b) => a.localeCompare(b, undefined, { sensitivity:"base" }));
    saveRoster();
  }

  el("newNames").value = "";
  showTab("board");
}

async function copyList(){
  try { await navigator.clipboard.writeText(el("exportEl").value || ""); } catch {}
}

function downloadCSV(){
  const csv = "Name\n" + signed.map(n => `"${n.replaceAll('"','""')}"`).join("\n");
  const blob = new Blob([csv], {type:"text/csv;charset=utf-8"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "signed_in.csv";
  document.body.appendChild(a);
  a.click();
  a.remove();
}

function resetAll(){
  if(confirm("Reset sign-ins?")){
    signed = [];
    localStorage.removeItem(STORAGE_SIGNED);
    render();
  }
}

// Persist roster at least once (first run)
saveRoster();
render();
</script>
</body>
</html>
